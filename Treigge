CREATE DATABASE PodporinLOGITpv23;

--trigerid
--SQL trigern- protsess
--mille abil tema sisse
--kirjutatud tegevused automaayselt käivitatakse

--insert; update; delete trigerid,
--mis jälgivad antud tegevused tabelites
--ja kirjutavad logi yabeli mida nad jälgisid

create database trigerLOGIT;
use trigerLOGIT
create table toode(
toodeID int primary key identity(1,1),
toodeNIMetus varchar(25),
toodeHind decimal(5,2))
--tabel logi, mis täidab triger
create table logi( 
id int primary key identity(1,1),
tegevus varchar(25),
kuupaev datetime,
andmed text)


--isert triger, mis jägib andmete lisamine toode tabelisse
create trigger toodeLisamine
on toode
for insert
as
insert into logi(tegevus, kuupaev, andmed )
select 'toode on lisatud',
getdate(),
inserted.toodeNIMetus
from inserted;

drop trigger toodeLisamine;

--kontroll
insert into toode(toodeNIMetus,toodeHind )
values ('Fanta', 2.20);

select * from toode;
select * from logi;
